{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.fetchChallengeCode = fetchChallengeCode;\n  var _env2 = require(_dependencyMap[0], \"expo/virtual/env\");\n  // Utility to fetch a Challenge Code from backend with graceful fallback\n  // Uses Expo public env vars. If the backend is unavailable, generates a deterministic-looking fallback.\n\n  const BASE_URL = _env2.env.EXPO_PUBLIC_BASE_URL || _env2.env.EXPO_PUBLIC_PROXY_BASE_URL || _env2.env.EXPO_PUBLIC_HOST || \"\";\n  function generateFallbackChallengeCode(userId, requestId) {\n    const seed = `${userId || \"user\"}-${requestId || \"req\"}-${Date.now()}`;\n    const hash = [...seed].reduce((acc, ch) => acc * 31 + ch.charCodeAt(0) >>> 0, 7);\n    const alphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    let code = \"ECHO\";\n    for (let i = 0; i < 8; i++) {\n      const idx = (hash >>> i * 4) % alphabet.length; // unsigned shift to avoid negative modulo\n      code += alphabet[idx];\n    }\n    return code;\n  }\n  async function fetchChallengeCode({\n    userId,\n    requestId,\n    signal\n  }) {\n    // If no backend configured, return fallback immediately\n    if (!BASE_URL) {\n      return generateFallbackChallengeCode(userId, requestId);\n    }\n    try {\n      const url = `${BASE_URL.replace(/\\/$/, \"\")}/api/camera/challenge?userId=${encodeURIComponent(userId || \"\")}&requestId=${encodeURIComponent(requestId || \"\")}`;\n      const res = await fetch(url, {\n        method: \"GET\",\n        headers: {\n          Accept: \"application/json\"\n        },\n        signal\n      });\n      if (!res.ok) {\n        throw new Error(`Challenge fetch failed: ${res.status}`);\n      }\n      const data = await res.json();\n      if (data?.code && typeof data.code === \"string\") {\n        return data.code;\n      }\n      return generateFallbackChallengeCode(userId, requestId);\n    } catch (e) {\n      console.warn(\"Challenge code fetch error:\", e?.message || e);\n      return generateFallbackChallengeCode(userId, requestId);\n    }\n  }\n});","lineCount":53,"map":[[7,2,1,0],[8,2,2,0],[10,2,4,0],[10,8,4,6,"BASE_URL"],[10,16,4,14],[10,19,5,2,"_env2"],[10,24,5,2],[10,25,5,2,"env"],[10,28,5,2],[10,29,5,2,"EXPO_PUBLIC_BASE_URL"],[10,49,5,2],[10,53,5,2,"_env2"],[10,58,5,2],[10,59,5,2,"env"],[10,62,5,2],[10,63,5,2,"EXPO_PUBLIC_PROXY_BASE_URL"],[10,89,6,40],[10,93,6,40,"_env2"],[10,98,6,40],[10,99,6,40,"env"],[10,102,6,40],[10,103,6,40,"EXPO_PUBLIC_HOST"],[10,119,7,30],[10,123,8,2],[10,125,8,4],[11,2,10,0],[11,11,10,9,"generateFallbackChallengeCode"],[11,40,10,38,"generateFallbackChallengeCode"],[11,41,10,39,"userId"],[11,47,10,45],[11,49,10,47,"requestId"],[11,58,10,56],[11,60,10,58],[12,4,11,2],[12,10,11,8,"seed"],[12,14,11,12],[12,17,11,15],[12,20,11,18,"userId"],[12,26,11,24],[12,30,11,28],[12,36,11,34],[12,40,11,38,"requestId"],[12,49,11,47],[12,53,11,51],[12,58,11,56],[12,62,11,60,"Date"],[12,66,11,64],[12,67,11,65,"now"],[12,70,11,68],[12,71,11,69],[12,72,11,70],[12,74,11,72],[13,4,12,2],[13,10,12,8,"hash"],[13,14,12,12],[13,17,12,15],[13,18,12,16],[13,21,12,19,"seed"],[13,25,12,23],[13,26,12,24],[13,27,12,25,"reduce"],[13,33,12,31],[13,34,12,32],[13,35,12,33,"acc"],[13,38,12,36],[13,40,12,38,"ch"],[13,42,12,40],[13,47,12,46,"acc"],[13,50,12,49],[13,53,12,52],[13,55,12,54],[13,58,12,57,"ch"],[13,60,12,59],[13,61,12,60,"charCodeAt"],[13,71,12,70],[13,72,12,71],[13,73,12,72],[13,74,12,73],[13,79,12,79],[13,80,12,80],[13,82,12,82],[13,83,12,83],[13,84,12,84],[14,4,13,2],[14,10,13,8,"alphabet"],[14,18,13,16],[14,21,13,19],[14,59,13,57],[15,4,14,2],[15,8,14,6,"code"],[15,12,14,10],[15,15,14,13],[15,21,14,19],[16,4,15,2],[16,9,15,7],[16,13,15,11,"i"],[16,14,15,12],[16,17,15,15],[16,18,15,16],[16,20,15,18,"i"],[16,21,15,19],[16,24,15,22],[16,25,15,23],[16,27,15,25,"i"],[16,28,15,26],[16,30,15,28],[16,32,15,30],[17,6,16,4],[17,12,16,10,"idx"],[17,15,16,13],[17,18,16,16],[17,19,16,17,"hash"],[17,23,16,21],[17,28,16,27,"i"],[17,29,16,28],[17,32,16,31],[17,33,16,33],[17,37,16,37,"alphabet"],[17,45,16,45],[17,46,16,46,"length"],[17,52,16,52],[17,53,16,53],[17,54,16,54],[18,6,17,4,"code"],[18,10,17,8],[18,14,17,12,"alphabet"],[18,22,17,20],[18,23,17,21,"idx"],[18,26,17,24],[18,27,17,25],[19,4,18,2],[20,4,19,2],[20,11,19,9,"code"],[20,15,19,13],[21,2,20,0],[22,2,22,7],[22,17,22,22,"fetchChallengeCode"],[22,35,22,40,"fetchChallengeCode"],[22,36,22,41],[23,4,22,43,"userId"],[23,10,22,49],[24,4,22,51,"requestId"],[24,13,22,60],[25,4,22,62,"signal"],[26,2,22,69],[26,3,22,70],[26,5,22,72],[27,4,23,2],[28,4,24,2],[28,8,24,6],[28,9,24,7,"BASE_URL"],[28,17,24,15],[28,19,24,17],[29,6,25,4],[29,13,25,11,"generateFallbackChallengeCode"],[29,42,25,40],[29,43,25,41,"userId"],[29,49,25,47],[29,51,25,49,"requestId"],[29,60,25,58],[29,61,25,59],[30,4,26,2],[31,4,28,2],[31,8,28,6],[32,6,29,4],[32,12,29,10,"url"],[32,15,29,13],[32,18,29,16],[32,21,29,19,"BASE_URL"],[32,29,29,27],[32,30,29,28,"replace"],[32,37,29,35],[32,38,29,36],[32,43,29,41],[32,45,29,43],[32,47,29,45],[32,48,29,46],[32,80,29,78,"encodeURIComponent"],[32,98,29,96],[32,99,30,6,"userId"],[32,105,30,12],[32,109,30,16],[32,111,31,4],[32,112,31,5],[32,126,31,19,"encodeURIComponent"],[32,144,31,37],[32,145,31,38,"requestId"],[32,154,31,47],[32,158,31,51],[32,160,31,53],[32,161,31,54],[32,163,31,56],[33,6,33,4],[33,12,33,10,"res"],[33,15,33,13],[33,18,33,16],[33,24,33,22,"fetch"],[33,29,33,27],[33,30,33,28,"url"],[33,33,33,31],[33,35,33,33],[34,8,34,6,"method"],[34,14,34,12],[34,16,34,14],[34,21,34,19],[35,8,35,6,"headers"],[35,15,35,13],[35,17,35,15],[36,10,36,8,"Accept"],[36,16,36,14],[36,18,36,16],[37,8,37,6],[37,9,37,7],[38,8,38,6,"signal"],[39,6,39,4],[39,7,39,5],[39,8,39,6],[40,6,41,4],[40,10,41,8],[40,11,41,9,"res"],[40,14,41,12],[40,15,41,13,"ok"],[40,17,41,15],[40,19,41,17],[41,8,42,6],[41,14,42,12],[41,18,42,16,"Error"],[41,23,42,21],[41,24,42,22],[41,51,42,49,"res"],[41,54,42,52],[41,55,42,53,"status"],[41,61,42,59],[41,63,42,61],[41,64,42,62],[42,6,43,4],[43,6,44,4],[43,12,44,10,"data"],[43,16,44,14],[43,19,44,17],[43,25,44,23,"res"],[43,28,44,26],[43,29,44,27,"json"],[43,33,44,31],[43,34,44,32],[43,35,44,33],[44,6,45,4],[44,10,45,8,"data"],[44,14,45,12],[44,16,45,14,"code"],[44,20,45,18],[44,24,45,22],[44,31,45,29,"data"],[44,35,45,33],[44,36,45,34,"code"],[44,40,45,38],[44,45,45,43],[44,53,45,51],[44,55,45,53],[45,8,46,6],[45,15,46,13,"data"],[45,19,46,17],[45,20,46,18,"code"],[45,24,46,22],[46,6,47,4],[47,6,48,4],[47,13,48,11,"generateFallbackChallengeCode"],[47,42,48,40],[47,43,48,41,"userId"],[47,49,48,47],[47,51,48,49,"requestId"],[47,60,48,58],[47,61,48,59],[48,4,49,2],[48,5,49,3],[48,6,49,4],[48,13,49,11,"e"],[48,14,49,12],[48,16,49,14],[49,6,50,4,"console"],[49,13,50,11],[49,14,50,12,"warn"],[49,18,50,16],[49,19,50,17],[49,48,50,46],[49,50,50,48,"e"],[49,51,50,49],[49,53,50,51,"message"],[49,60,50,58],[49,64,50,62,"e"],[49,65,50,63],[49,66,50,64],[50,6,51,4],[50,13,51,11,"generateFallbackChallengeCode"],[50,42,51,40],[50,43,51,41,"userId"],[50,49,51,47],[50,51,51,49,"requestId"],[50,60,51,58],[50,61,51,59],[51,4,52,2],[52,2,53,0],[53,0,53,1],[53,3]],"functionMap":{"names":["<global>","generateFallbackChallengeCode","reduce$argument_0","fetchChallengeCode"],"mappings":"AAA;ACS;gCCE,gDD;CDQ;OGE;CH+B"}},"type":"js/module"}]}